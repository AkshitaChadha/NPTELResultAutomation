<!DOCTYPE html>
<html>
<head>
    <title>Teacher Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
</head>
<body>

     <input type="hidden" name="subject_id" value="{{ session.get('active_subject') }}">

<!-- ===== NAVBAR ===== -->
<div class="navbar">
    <h3>NPTEL Result System</h3>

    <div class="nav-actions">
        <a href="/teacher_dashboard">
            <button class="secondary-btn">Dashboard</button>
        </a>

        <a href="/logout">
            <button class="primary-btn">Logout</button>
        </a>
    </div>
</div>

<div class="container">

<!-- ===== HEADER SECTION (SAME AS HOD) ===== -->
<div style="display:flex; justify-content:space-between; align-items:flex-start;">

    <!-- LEFT SIDE -->
    <div>
        <h2 class="page-title">Teacher Dashboard</h2>
       <p><b>Teacher:</b> {{ teacher["name"] }}</p>
       <p><b>Current Session:</b> {{ session_label }}</p>
    </div>

    <!-- RIGHT SIDE (SESSION DROPDOWN ONLY) -->
    <div>
        <form method="POST" action="/set_session">
            <select name="session_label"
                    onchange="this.form.submit()"
                    class="session-select">
                {% for s in all_sessions %}
                <option value="{{ s }}"
                        {% if s == session_label %}selected{% endif %}>
                    {{ s }}
                </option>
                {% endfor %}
            </select>
        </form>
    </div>

</div>

<hr>

<h3>Your Subjects</h3>


{% if branch_map %}

{% for branch, semesters in branch_map.items() %}

<h3 style="margin-top:30px;">Branch: {{ branch }}</h3>

<table class="styled-table">

<tr>
<th>Semester</th>
<th>Subject</th>
<th>Action</th>
</tr>

{% for sem, subjects in semesters.items() %}
    {% for sub in subjects %}
    <tr>

        <td>{{ sem }}</td>

        <td>
            <b>{{ sub["subject_name"] }}</b><br>
            <small>
                Code: {{ sub["subject_code"] }} |
                Section: {{ sub["section"] }}
            </small>
        </td>

        <td>

{% if sub["stage"] == "college_done" %}

    <!-- View Result -->
    <a href="{{ url_for('evaluate') }}?subject_id={{ sub['id'] }}">
        <button class="success-btn">View Result</button>
    </a>

    <!-- ðŸ”“ Edit Unlocked (if any) -->
    {% if sub.get("locked") == 1 and sub.get("unlocked_count", 0) > 0 %}
        <a href="/edit_unlocked/{{ sub['id'] }}">
            <button class="yellow-btn">
                Edit Unlocked ({{ sub["unlocked_count"] }})
            </button>
        </a>
    {% endif %}

{% elif sub["stage"] in ["registration_done", "assignment_done", "external_saved", "college_pending"] %}

    <!-- Continue -->
    <a href="{{ url_for('upload') }}?subject_id={{ sub['id'] }}">
        <button class="primary-btn">Continue Evaluation</button>
    </a>

    <!-- Reset -->
    {% if sub["locked"] == 0 %}
    <form method="POST"
          action="{{ url_for('reset_evaluation', subject_id=sub['id']) }}"
          style="display:inline;"
          onsubmit="return confirm('Are you sure? This will permanently delete all evaluation data for this subject.');">

        <button class="danger-btn">
            Reset Evaluation
        </button>
    </form>
    {% endif %}
{% else %}

    <!-- Start Evaluation -->
    <a href="{{ url_for('upload') }}?subject_id={{ sub['id'] }}">
        <button class="primary-btn">Start Evaluation</button>
    </a>

{% endif %}

</td>
    </tr>
    {% endfor %}
{% endfor %}

</table>

{% endfor %}

{% else %}
<p>No subjects assigned yet.</p>
{% endif %}

</div>

</body>
</html>
