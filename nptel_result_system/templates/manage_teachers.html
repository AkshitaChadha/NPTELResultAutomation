<!DOCTYPE html>
<html>
<head>
<title>Manage Teachers</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

<style>
/* Flash Messages */
.alert {
    padding: 12px;
    margin-bottom: 20px;
    border-radius: 6px;
    font-weight: 500;
}

.alert-success {
    background-color: #e8f5e9;
    color: #2e7d32;
    border: 1px solid #2e7d32;
}

.alert-danger {
    background-color: #fdecea;
    color: #c0392b;
    border: 1px solid #c0392b;
}
</style>

</head>
<body>

<div class="navbar">
    <h3>NPTEL Result System</h3>

    <div class="nav-actions">
        <a href="/hod_dashboard">
            <button class="secondary-btn">Dashboard</button>
        </a>
        <a href="/logout">
            <button class="primary-btn">Logout</button>
        </a>
    </div>
</div>

<div class="mergecontainer">

<h2 class="page-title">Manage Teachers</h2>
<br>

<!-- ================= FLASH MESSAGES ================= -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- ================= Manual Add ================= -->
<form method="POST" class="form-box">
    <input type="hidden" name="manual_add" value="1">

    <div class="form-group">
        <label>Name</label><br>
        <input name="name" required>
    </div>

    <div class="form-group">
        <label>Email</label><br>
        <input name="email" required>
    </div>

    <button class="primary-btn">Add Teacher</button>
</form>

<hr>

<!-- ================= Excel Upload ================= -->
<form method="POST" enctype="multipart/form-data" class="form-box">
    <input type="hidden" name="excel_upload" value="1">

    <div class="form-group">
        <label>Upload Excel (Columns: name, email)</label><br>
        <input type="file" name="file" required>
    </div>

    <button class="secondary-btn">Upload</button>
</form>

<br>
<hr>

<!-- ================= Teachers Table ================= -->
{% if teachers %}

<table class="styled-table">
<tr>
    <th>Name</th>
    <th>Email</th>
    <th>Role</th>
    {% if is_super_admin %}
        <th>Admin Control</th>
    {% endif %}
    <th>Action</th>
</tr>

{% for t in teachers %}
<tr>

<td>{{ t["name"] }}</td>
<td>{{ t["email"] }}</td>

<!-- ROLE COLUMN -->
<td>
    {% if t["is_admin"] == 1 %}
        <span style="color:#27ae60; font-weight:bold;">
            Admin
        </span>
    {% else %}
        <span style="color:#7f8c8d;">
            Teacher
        </span>
    {% endif %}
</td>

{% if is_super_admin %}
<td>
    <form method="POST" action="/toggle_admin/{{ t['id'] }}">
        {% if t["is_admin"] == 1 %}
            <button class="secondary-btn">Remove Admin</button>
        {% else %}
            <button class="primary-btn">Make Admin</button>
        {% endif %}
    </form>
</td>
{% endif %}

<!-- DELETE -->
<td>
    <a href="/delete_teacher/{{ t['id'] }}"
       onclick="return confirm('Are you sure you want to delete this teacher?');">
        <button type="button" class="secondary-btn">Delete</button>
    </a>
</td>

</tr>
{% endfor %}
</table>

{% else %}
<p>No teachers added yet.</p>
{% endif %}

</div>

<!-- Auto-hide flash after 3 sec -->
<script>
setTimeout(function() {
    let alerts = document.querySelectorAll('.alert');
    alerts.forEach(alert => alert.style.display = 'none');
}, 3000);
</script>

</body>
</html>